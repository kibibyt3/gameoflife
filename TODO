optimize and clean up code
